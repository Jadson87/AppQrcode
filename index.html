<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pit Stop JadEx</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
      background: linear-gradient(180deg, #f7f9fc 0%, #e4e9f2 100%);
      color: #333;
    }
    h1 { text-align: center; color: #0078d7; margin-bottom: 10px; }
    #reader {
      width: 280px; margin: 20px auto;
      border-radius: 10px; overflow: hidden;
      box-shadow: 0 0 8px rgba(0,0,0,0.15);
    }
    table {
      width: 100%; margin-top: 10px;
      border-collapse: collapse; background: white;
      border-radius: 10px; overflow: hidden;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    th { background: #0078d7; color: white; text-align: left; padding: 10px; }
    td { border-bottom: 1px solid #eee; padding: 10px; vertical-align: middle; }
    td img { width: 50px; height: 50px; border-radius: 8px; object-fit: cover; margin-right: 8px; }
    .produto-info { display: flex; align-items: center; }
    .total { font-size: 1.3em; font-weight: bold; text-align: right; margin-top: 15px; color: #222; }
    button {
      background: #0078d7; color: white; border: none;
      padding: 10px 16px; border-radius: 8px; cursor: pointer;
      display: block; margin: 15px auto; font-size: 1em;
    }
    button:hover { background: #005fa3; }
    .botao-limpar { background: #ff5555; }
    .botao-limpar:hover { background: #ff2222; }
    #pagamento {
      display: none; text-align: center;
    }
    #qr-pix {
      width: 220px; margin-top: 20px;
      border-radius: 12px; box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <h1>üõí Pit Stop JadEx</h1>
  <p style="text-align:center;">Aponte a c√¢mera para o QR Code do produto para adicionar ao carrinho.</p>

  <div id="principal">
    <div id="reader"></div>

    <table>
      <thead>
        <tr><th>Produto</th><th>Pre√ßo</th></tr>
      </thead>
      <tbody id="cart"></tbody>
    </table>

    <div class="total">Total: R$ <span id="total">0.00</span></div>

    <button onclick="irParaPagamento()">üí∞ Pagar com Pix</button>
    <button class="botao-limpar" onclick="limparCarrinho()">üßπ Limpar carrinho</button>
  </div>

  <div id="pagamento">
    <h2>Pagamento via Pix</h2>
    <p>Escaneie o QR Code abaixo ou copie o c√≥digo Pix.</p>
    <img id="qr-pix" alt="QR Code Pix">
    <p><strong>Valor:</strong> R$ <span id="valor-pix"></span></p>
    <textarea id="codigo-pix" rows="3" style="width:90%;"></textarea>
    <br>
    <button onclick="voltar()">‚¨ÖÔ∏è Voltar</button>
  </div>

  <script>
    // üßÉ Produtos cadastrados
    const produtos = {
       "REF001": { nome: "Refrigerante Pepsi Lata 350 ml", preco: 3.70, imagem: "refrigerante-lata.jpg" },
      "REF002": { nome: "Refrigerante Pepsi Black Lata 350 ml", preco: 4.00, imagem: "refrigerante-lata.jpg" },
      "REF003": { nome: "Refrigerante Pepsi Twist Lata 350 ml", preco: 4.00, imagem: "refrigerante-lata.jpg" },
      "REF004": { nome: "Refrigerante Guaran√° Ant√°rtica Lata 350 ml", preco: 4.00, imagem: "refrigerante-lata.jpg" },
      "REF005": { nome: "Refrigerante Guaran√° Ant√°rtica Zero Lata 350 ml", preco: 4.00, imagem: "refrigerante-lata.jpg" },
      "REF006": { nome: "Refrigerante Sukita Lata 350 ml", preco: 3.70, imagem: "refrigerante-lata.jpg" },
      "REF007": { nome: "Refrigerante Soda Limonada Lata 350 ml", preco: 3.70, imagem: "refrigerante-lata.jpg" },
      "AGU001": { nome: "√Ågua Mineral indai√° c g√°s 330 ml", preco: 3.50, imagem: "aguacomgas.jpg" }
      "AGU002": { nome: "√Ågua Mineral indai√° 330 ml", preco: 2.50, imagem: "refrigerante-lata.jpg" },  
      "SAL001": { nome: "Salgadinho", preco: 5.00, imagem: "salgadinho.jpg" }
    };

    let total = 0;
    const chavePix = "85987398273"; // üü° COLOQUE SUA CHAVE PIX AQUI
    const nomeLoja = "Pit Stop JadEx";

    function adicionarProduto(codigo) {
      const produto = produtos[codigo];
      if (!produto) {
        alert("‚ùå Produto n√£o encontrado!");
        return;
      }

      const linha = document.createElement("tr");
      linha.innerHTML = `
        <td>
          <div class="produto-info">
            <img src="${produto.imagem}" alt="${produto.nome}">
            <span>${produto.nome}</span>
          </div>
        </td>
        <td>R$ ${produto.preco.toFixed(2)}</td>
      `;
      document.getElementById("cart").appendChild(linha);
      total += produto.preco;
      document.getElementById("total").textContent = total.toFixed(2);
    }

    function limparCarrinho() {
      document.getElementById("cart").innerHTML = "";
      total = 0;
      document.getElementById("total").textContent = "0.00";
    }

    function gerarPayloadPix(valor) {
      // Cria o c√≥digo Pix (payload simplificado)
      const formatted = valor.toFixed(2);
      return `00020126360014BR.GOV.BCB.PIX0114${chavePix}5204000053039865404${formatted.replace('.', '')}5802BR5915${nomeLoja}6009SAO PAULO62100506ABC1236304`;
    }

    function irParaPagamento() {
      if (total <= 0) {
        alert("Adicione algum produto primeiro!");
        return;
      }

      document.getElementById("principal").style.display = "none";
      document.getElementById("pagamento").style.display = "block";

      const valor = total;
      const payload = gerarPayloadPix(valor);

      document.getElementById("valor-pix").textContent = valor.toFixed(2);
      document.getElementById("codigo-pix").value = payload;

      // Gera o QR Code via API do Google
      const qrUrl = `https://chart.googleapis.com/chart?chs=250x250&cht=qr&chl=${encodeURIComponent(payload)}`;
      document.getElementById("qr-pix").src = qrUrl;
    }

    function voltar() {
      document.getElementById("principal").style.display = "block";
      document.getElementById("pagamento").style.display = "none";
    }

    // üì∑ Inicializa o leitor de QR Code
    const html5QrCode = new Html5Qrcode("reader");
    html5QrCode.start(
      { facingMode: "environment" },
      { fps: 10, qrbox: 200 },
      (decodedText) => adicionarProduto(decodedText.trim())
    ).catch(err => {
      console.error("Erro ao iniciar a c√¢mera:", err);
      alert("N√£o foi poss√≠vel acessar a c√¢mera. Verifique as permiss√µes.");
    });
  </script>
</body>
</html>
